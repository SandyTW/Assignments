<!DOCTYPE html>
<html>

<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='WK7style.css')}}">

    <title>Successfully Login</title>
</head>

<body style="margin:0px;">
    <header>
        <div class='title'>歡迎光臨，這是會員頁</div>
    </header>

    <div class="content">{{session.name}}，歡迎登入系統</div>
    <button onclick="window.location = 'http://127.0.0.1:3000/signout'" type="submit" class='dropbtn'>登出系統</button>

    <!-- 查詢會員姓名 -->
    <div class="content">查詢會員姓名</div>
    <form action="/api/users" method="GET" class="input" id="getData">
        <input type="text" name="username" id='username' required>
        <button style="margin:7px" id='btnSearch'>查詢</button>
    </form>
    <div class=content id='Displayname'></div>

</body>

</html>

<script>
    document.getElementById("btnSearch").addEventListener('click', getName);

    function getName(e) {
        e.preventDefault();
        let req = new XMLHttpRequest();
        let username = document.getElementById("username").value;
        req.open('GET', '/api/users?username=' + username, true);
        req.onload = function () {
            if (this.status == 200) {
                console.log(`req this.responseText: ${this.responseText}`)
                let user = JSON.parse(this.responseText);
                let display;
                try {
                    display = user['data']['name'];
                }catch(error){
                    display='No Record';
                }
                console.log(display);
                showData(display);
            };
           
        };
        req.send();
    };
    function showData(display){
        let box = document.createElement('div');
        let column = document.getElementById('Displayname');
        box.textContent='';
        column.textContent='';
        document.getElementById('Displayname').appendChild(box);
        box.textContent=display;
    }

</script>